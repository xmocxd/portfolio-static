<div class="relative">
    <div class="w-2/3 md:w-1/3 mx-auto border-t border-gray-400 dark:border-gray-600 my-16"></div>
    <div id="random-line-art-container" class="lines">
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", (event) => {
        const config = {
            boxSize: 120,
            containerSize: 600,
            maxBoxes: 14,
            maxColumns: 3,
            maxColumnHeight: 10,
            linesContainer: "random-line-art-container"
        };
        
        const linesContainer = document.getElementById(config.linesContainer);
        linesContainer.style.height = config.containerSize + "px";
        let column = 0;
        let currentStack = 0;
        let prevElement = null;
        
        const fullX = () => {
            const lineBox = weightedRandomFunction(boxWeightsArray);
            
            let line;
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("r");
            lineBox.appendChild(line);
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("l");
            lineBox.appendChild(line);
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("r");
            line.classList.add("t");
            lineBox.appendChild(line);
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("l");
            line.classList.add("t");
            lineBox.appendChild(line);
            
            return lineBox;
        };
        
        const bottomV = () => {
            const lineBox = weightedRandomFunction(boxWeightsArray);
            
            let line;
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("r");
            lineBox.appendChild(line);
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("l");
            lineBox.appendChild(line);
            
            return lineBox;
        };
        
        const topV = () => {
            const lineBox = weightedRandomFunction(boxWeightsArray);
            
            let line;
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("r");
            line.classList.add("t");
            lineBox.appendChild(line);
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("l");
            line.classList.add("t");
            lineBox.appendChild(line);
            
            return lineBox;
        };
        
        const lineR = () => {
            const lineBox = weightedRandomFunction(boxWeightsArray);
            
            let line;
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("r");
            lineBox.appendChild(line);
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("r");
            line.classList.add("t");
            lineBox.appendChild(line);
            
            return lineBox;
        };
        
        const lineL = () => {
            const lineBox = weightedRandomFunction(boxWeightsArray);
            
            let line;
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("l");
            lineBox.appendChild(line);
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("l");
            line.classList.add("t");
            lineBox.appendChild(line);
            
            return lineBox;
        };
        
        const rightV = () => {
            const lineBox = weightedRandomFunction(boxWeightsArray);
            
            let line;
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("r");
            lineBox.appendChild(line);
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("l");
            line.classList.add("t");
            lineBox.appendChild(line);
            
            return lineBox;
        };
        
        const leftV = () => {
            const lineBox = weightedRandomFunction(boxWeightsArray);
            
            let line;
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("l");
            lineBox.appendChild(line);
            
            line = document.createElement("div");
            line.classList.add("line");
            line.classList.add("h");
            line.classList.add("r");
            line.classList.add("t");
            lineBox.appendChild(line);
            
            return lineBox;
        };
        
        const breakDiv = () => {
            // Add a breaking div to force boxes to the next column
            
            if (
            column === config.maxColumns
            || !prevElement
            || prevElement.classList.contains('break')
            ) {
                // don't break if on last column, first element, or prev element was a break
                return false;
            }
            const div = document.createElement("div");
            div.classList.add("break");
            
            // Set column and reset stack count
            column++;
            currentStack = 0;
            
            return div;
        };
        
        const borderT = () => {
            const lineBox = document.createElement("div");
            lineBox.classList.add("line-box");
            lineBox.classList.add("t");
            lineBox.style.height = config.boxSize + "px";
            lineBox.style.width = config.boxSize + "px";
            return lineBox;
        };
        const borderR = () => {
            const lineBox = document.createElement("div");
            lineBox.classList.add("line-box");
            lineBox.classList.add("r");
            lineBox.style.height = config.boxSize + "px";
            lineBox.style.width = config.boxSize + "px";
            return lineBox;
        };
        const borderB = () => {
            const lineBox = document.createElement("div");
            lineBox.classList.add("line-box");
            lineBox.classList.add("b");
            lineBox.style.height = config.boxSize + "px";
            lineBox.style.width = config.boxSize + "px";
            return lineBox;
        };
        const borderL = () => {
            const lineBox = document.createElement("div");
            lineBox.classList.add("line-box");
            lineBox.classList.add("l");
            lineBox.style.height = config.boxSize + "px";
            lineBox.style.width = config.boxSize + "px";
            return lineBox;
        };
        const noBorder = () => {
            const lineBox = document.createElement("div");
            lineBox.classList.add("line-box");
            lineBox.style.height = config.boxSize + "px";
            lineBox.style.width = config.boxSize + "px";
            return lineBox;
        };
        
        const lineWeightsArray = [
        { "weight": 1, "function": fullX },
        { "weight": 8, "function": bottomV },
        { "weight": 1, "function": topV },
        { "weight": 9, "function": rightV },
        { "weight": 8, "function": leftV },
        { "weight": 5, "function": lineR },
        { "weight": 6, "function": lineL },
        { "weight": 4, "function": breakDiv }
        ];
        
        const boxWeightsArray = [
        { "weight": 0, "function": borderT },
        { "weight": 0, "function": borderR },
        { "weight": 0, "function": borderB },
        { "weight": 7, "function": borderL },
        { "weight": 10, "function": noBorder }
        ];
        
        const weightedRandomFunction = (weights) => {
            const sum = weights.reduce((acc, e) => acc + e.weight, 0);
            const rnd = Math.random();
            const normalizedWeights = []; 
            
            
            for (let i = 0; i < weights.length; i++) {
                let previous = i > 0 ? normalizedWeights[i-1].weight : 0;
                normalizedWeights.push({
                    "weight": weights[i].weight/sum + previous,
                    "function": weights[i].function
                });
            }
            
            return normalizedWeights.find(e => rnd <= e.weight).function();
        };
        
        for (let i = 0; i < config.maxBoxes; i++) {
            if (column < config.maxColumns) {
                // only add new boxes if we are within maxColumns
                // -- this results in potentially fewer than maxBoxes, but prevents overflow of the flex container
                const element = weightedRandomFunction(lineWeightsArray);
                if (element) {
                    prevElement = element;
                    currentStack++;
                    linesContainer.appendChild(element);
                }
                
                if (currentStack * config.boxSize >= config.containerSize) {
                    // if wrapping at edge of container
                    
                    // Set column and reset stack count
                    column++;
                    currentStack = 0;
                    
                }
            }
        }
        
    });
</script>